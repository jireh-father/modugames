# Zombie World v2 - 생존자 (Survivor) 게임 재설계

> 버전: v2.0
> 날짜: 2026-02-28
> 상태: 승인됨

## 개요

기존 "타워 중심 디펜스"에서 **"플레이어 캐릭터 + 타워 활용"** 방식으로 대규모 재설계.
플레이어가 직접 타워에서 내려와 아이템을 수집하고, 3개 타워를 오가며 생존하는 게임.

---

## 1. 맵 구조

```
┌────────────────────────────────────┐ y=0
│           HUD (점수/웨이브/HP)       │ y=48
├────────────────────────────────────┤
│                                    │
│    ┌──┐      ┌─────┐    ┌──┐      │  폐허 도시 (건물=장애물)
│    │건│      │ 건물 │    │건│      │  좀비 스폰 영역 (y < 벽)
│    │물│      │      │    │물│      │
│    └──┘      └─────┘    └──┘      │
│         도로      도로             │
│    ┌───┐              ┌───┐       │
│    │건물│              │건물│       │
│    └───┘              └───┘       │
│                                    │
│═══[문]═══[문]═══[문]═══[문]════════│ y=520 벽(4구간, 3개 문)
│                                    │
│  [타워L]    [타워C]    [타워R]      │ y=590 타워 3개 고정
│                                    │
├────────────────────────────────────┤ y=672 컨트롤
│  무기슬롯탭 + 아이템바               │
│  무기 조작 영역                     │
└────────────────────────────────────┘ y=960
```

### 1.1 건물 (장애물)
- 직사각형 블록, 랜덤 크기 (40~120px x 40~80px)
- 회색/갈색 톤, 부서진 건물은 금이 가거나 일부 무너진 표현
- **충돌 장애물**: 플레이어와 좀비 모두 통과 불가
- 도로(빈 공간)를 통해 이동
- 게임 시작 시 랜덤 배치 (매 게임마다 다른 맵)

### 1.2 벽 시스템
- 기존 4구간 벽 유지 (y=520)
- **3곳에 문 추가** (벽 구간 사이)
  - 문 위치: 구간0-1 사이, 1-2 사이, 2-3 사이
  - 플레이어가 이동 경로에 벽이 있으면 가장 가까운 문으로 우회
  - 좀비는 문을 사용하지 않음 (벽을 부수고 통과)
- 벽 HP, 파괴, 자동 재건 시스템 유지

### 1.3 타워 3개
- **위치**: 좌(x≈90), 중(x≈270), 우(x≈450), y=590 고정
- **이동 불가** (고정 위치)
- 각 타워 HP: 200 (기존과 동일)
- 파괴 시: 올라갈 수 없음
- 수리: 벽돌 아이템으로 수리 가능

---

## 2. 플레이어 시스템

### 2.1 기본 속성
- **HP**: 100 (타워 HP와 별도)
- **이동 속도**: 좀비의 약 2배 (200px/s)
- **크기**: 16px 반경

### 2.2 상태 전환

```
[타워 위] ←→ [지상]
   │              │
   │ 내려오기     │ 타워 근처 탭
   │ 아이콘 탭    │ (올라가기)
   ↓              ↑
```

#### 타워 위 상태
- 플레이어는 안전 (좀비 접촉 대미지 없음)
- 좀비는 타워를 공격 → 타워 HP 감소
- 타워 파괴 시: 플레이어 강제로 지상에 내려옴
- 모든 무기 사용 가능 (기존과 동일한 컨트롤)
- **"내려오기" 아이콘** 표시 → 탭하면 지상으로

#### 지상 상태
- 좀비 접촉 시 플레이어 HP 감소
- 플레이어 HP = 0 → **게임오버**
- 현재 선택된 무기 + 가방 아이템 사용 가능
- 무기 탭 전환도 가능
- 맵 터치 → A* 경로탐색으로 자동 이동
- 다른 타워 근처에서 탭 → 올라가기 (파괴되지 않은 타워만)

### 2.3 이동 시스템
- **맵 터치**: 터치한 위치로 A* 경로탐색 이동
- 건물 자동 우회
- 벽 통과 시 가장 가까운 문으로 이동
- 이동 중 새 위치 터치 → 경로 변경
- 이동 중에도 무기 조작 가능 (하단 컨트롤 영역)

### 2.4 컨트롤 레이아웃
- 타워 위/지상 모두 동일한 하단 컨트롤 영역
- 무기 슬롯 탭 (기존 아이콘 방식)
- 아이템 바 (가방 아이템)
- 무기 조작 영역 (기존과 동일)
- **추가**: 타워 위일 때 "내려오기" 버튼
- **맵 터치 = 이동** (지상 상태일 때, 컨트롤 영역 밖)

---

## 3. 아이템 시스템

### 3.1 드롭
- 좀비 사망 시 해당 위치에 아이템 드롭
- 기존 드롭 테이블 유지 (탄약, 벽돌, 의료킷, 지뢰 등)

### 3.2 지속
- **영구 지속** (시간 경과로 사라지지 않음)
- 바닥에 아이콘으로 표시

### 3.3 수집
- 플레이어가 지상에서 아이템 위치 근처(30px)에 가면 자동 수집
- **바닥 아이템 탭** → 플레이어가 해당 위치로 자동 이동 후 수집
- 타워 위에서는 수집 불가 (반드시 내려와야 함)

---

## 4. 좀비 AI

### 4.1 소리 기반 이동
- 마지막으로 들은 소리 위치(x, y)를 기억
- 해당 위치를 향해 **직선 이동**
- 건물에 막히면 **제자리걸음** (경로탐색 없음, 우회 안 함)
- 소리 위치에 도착해도 **계속 그 방향으로 밀기** (새 소리 날 때까지)

### 4.2 벽 상호작용
- 소리를 따라 벽에 도달하면 벽을 계속 밀어서 파괴
- 벽이 부서지면 안쪽으로 진입

### 4.3 타워/플레이어 공격
- 벽 안쪽 진입 후:
  - 타워 근처 → 타워 공격 (타워 HP 감소)
  - 지상 플레이어 접촉 → 플레이어 HP 감소
- 좀비 시야/감지 범위는 소리 기반 (시각 감지 없음)

### 4.4 소리 전환
- 새로운 소리 발생 시: 범위 내 좀비는 새 소리 위치로 방향 전환
- 무기 발사 소리, 폭발 소리, 유인 아이템 소리 등 모두 적용
- 기존 sound source 시스템 활용

---

## 5. 경로탐색

### 5.1 그리드 시스템
- 맵을 타일 그리드로 분할 (예: 20px 단위 = 27x48 그리드)
- 건물/벽 위치에 따라 통행 불가 타일 마킹
- 문 위치는 통행 가능으로 마킹

### 5.2 A* (플레이어 전용)
- 플레이어 이동 시 A* 알고리즘으로 최적 경로 계산
- 문을 경유하는 경로 자동 생성
- 경로 시각화: 반투명 점선으로 이동 경로 표시

### 5.3 좀비는 A* 미사용
- 직선 이동만 (소리 방향)
- 충돌 시 정지 (제자리걸음)

---

## 6. 맵 배경 (폐허 도시)

### 6.1 비주얼
- 전체 바닥: 어두운 아스팔트 색 (#2a2a2a)
- 도로: 약간 밝은 회색 (#3a3a3a) + 점선 차선
- 건물: 회색/갈색 직사각형
  - 온전한 건물: 단색 + 테두리
  - 부서진 건물: 금 간 패턴, 일부 무너진 모서리
- 잔해: 작은 점/선으로 도로 위 잔해 표현 (장식용, 충돌 없음)

### 6.2 건물 배치 알고리즘
- 게임 시작 시 랜덤 생성
- 건물 간 최소 간격 보장 (이동 통로 확보)
- 벽 근처, 타워 위치에는 건물 배치 금지
- 도로망이 연결되도록 보장 (고립 영역 없음)

---

## 7. 게임오버 조건

- **기존**: 타워 HP = 0 → 게임오버
- **변경**: 플레이어 HP = 0 → 게임오버
- 타워 파괴 = 해당 타워 사용 불가 (게임은 계속)
- 모든 타워 파괴 + 플레이어 지상 = 매우 위험 (안전지대 없음)

---

## 8. 무기 시스템 (기존 유지)

- 6개 무기 + 가방: pistol, bow, sniper, mg, crossbow, flamethrower, pouch
- 타워 위/지상 모두 동일한 컨트롤
- 지상에서도 모든 무기 사용 가능
- 무기 탭 전환 가능

---

## 9. 파일 구조 변경 예상

### 신규 파일
- `player.js` - 플레이어 캐릭터 (HP, 이동, 상태, 렌더링)
- `pathfinding.js` - A* 그리드 경로탐색
- `buildings.js` - 건물 생성, 충돌, 렌더링
- `doors.js` - 벽의 문 시스템

### 대규모 수정
- `game.js` - 상태에 player, buildings, doors 추가. 타워 3개로 변경
- `tower.js` - 3개 타워, 이동 삭제, 올라가기/내려오기 UI
- `zombies.js` - 소리 기반 직선 이동 + 제자리걸음 + 플레이어 공격
- `items.js` - 드롭 위치 시스템, 영구 지속, 바닥 수집
- `renderer.js` - 폐허 도시 배경 렌더링
- `main.js` - 새 모듈 import, 업데이트/드로우 루프 수정
- `wall.js` - 문 시스템 추가
- `input.js` - 맵 터치 이동 입력 처리

### 소규모 수정
- `hud.js` - 플레이어 HP 표시, 타워 3개 상태
- `inventory.js` - 아이템 바 수집 연동
- `aiming.js` - 지상 상태에서의 조준 기준점 변경

---

## 변경 이력

| 날짜 | 버전 | 내용 |
|------|------|------|
| 2026-02-28 | v2.0 | 생존자 게임 재설계 문서 작성 |
